!function(a){function b(b){a(".wp-travel-open-uploaded-images ul").children().removeClass("featured-image"),a("#wp_travel_thumbnail_id").val(b),a("#wp-travel-gallery-image-list-"+b).addClass("featured-image")}function c(c){var e=wp.template("my-template");a(".wp-travel-open-uploaded-images ul").append(e(c)),d(c);var f=wp_travel_drag_drop_uploader._thumbnail_id;(1>f||void 0==f)&&(f=a(".wp-travel-open-uploaded-images ul li:first").data("attachmentid")),b(f)}function d(c){var d=[];if(a(".wp-travel-open-uploaded-images ul li").each(function(){d.push(a(this).data("attachmentid"))}),c.length>0){var e=wp_travel_drag_drop_uploader._thumbnail_id;1>e&&(e=a(".wp-travel-open-uploaded-images ul li:first").data("attachmentid")),b(e),a.each(c,function(a,b){d.push(parseInt(b.id))})}d=d.filter(Boolean);var f=d.filter(function(a,b,c){return b==c.indexOf(a)});""!=d?(a(".wp-travel-post-tab-content-section-title").show(),a(".wp-travel-open-uploaded-images .description").show()):(a(".wp-travel-post-tab-content-section-title").hide(),a(".wp-travel-open-uploaded-images .description").hide()),a("#wp_travel_gallery_ids").val(f.join(","))}a(function(){if(void 0!==wp_travel_drag_drop_uploader.gallery_data){c(wp_travel_drag_drop_uploader.gallery_data)}else a(".wp-travel-post-tab-content-section-title").hide();if(a(".wp-travel-open-uploaded-images ul").sortable({update:function(){d([])}}),a(document).on("click",".wp-travel-open-uploaded-images ul li",function(){b(a(this).data("attachmentid"))}),a(document).on("click",".wp-travel-open-uploaded-images ul li span",function(){if(!confirm("sure to delete?"))return!1;var c=a(this).parent(),e=c.data("attachmentid"),f=a("#wp_travel_thumbnail_id").val();c.fadeOut("slow",function(){if(a(this).remove(),f==e){b(a(".wp-travel-open-uploaded-images ul li:first").data("attachmentid"))}d([])})}),a(".wp-travel-open-uploader").wpTravelUploader({media_options:{multiple:!0},onSelect:function(a){attachments=a.state().get("selection").toJSON(),c(attachments)}}),"undefined"!=typeof uploader){a("input#plupload-browse-button").val(wp_travel_drag_drop_uploader.labels.uploader_files_computer);var e=a(".wp-travel-upload-progress-bar"),f=a(".wp-travel-upload-progress-bar div.wp-travel-upload-progress-bar-inner"),g=a(".wp-travel-upload-progress-bar div.wp-travel-upload-progress-bar-status"),h=a("#wp-travel-upload-error"),i=0;uploader.bind("FilesAdded",function(b,c){a(h).html(""),i=c.length,a(".uploading .current",a(g)).text("1"),a(".uploading .total",a(g)).text(i),a(".uploading",a(g)).show(),a(".done",a(g)).hide(),a(e).fadeIn()}),uploader.bind("UploadProgress",function(b,c){a(".uploading .current",a(g)).text(i-b.total.queued+1),a(f).css({width:b.total.percent+"%"})}),uploader.bind("FileUploaded",function(b,d,e){e.response.replace(/^<pre>(\d+)<\/pre>$/,"$1").match(/media-upload-error|error-div/)?a(h).html(e.response):a.post(wp_travel_drag_drop_uploader.ajax,{action:"envira_gallery_load_image",nonce:wp_travel_drag_drop_uploader.drag_drop_nonce,id:e.response},function(a){c([a])},"json")}),uploader.bind("UploadComplete",function(){a(".uploading",a(g)).hide(),a(".done",a(g)).show(),setTimeout(function(){a(e).fadeOut()},1e3)}),uploader.bind("Error",function(b,c){a(h).html('<div class="error fade"><p>'+c.file.name+": "+c.message+"</p></div>"),b.refresh()})}})}(jQuery);